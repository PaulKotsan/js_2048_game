new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.boardLayout=t,this.gameField=document.querySelector(".game-field"),this.fieldRows=Array.from(this.gameField.querySelectorAll("tr")),this.emptyCells=[],this.startMessage=document.querySelector(".message-start"),this.loseMessage=document.querySelector(".message-lose"),this.winMessage=document.querySelector(".message-win"),this.totalScoreMessage=document.querySelector(".message-tatal__score"),this.controlButton=document.querySelector(".button"),this.cheatButton=document.querySelector(".cheat-button"),this.state="idle",this.status="process",this.canMove=!0,this.oppositeMoveDirections={left:"right",right:"left",up:"down",down:"up"},this.lastMoveDirection="",this.countMoves=0}moveLeft(){this.canMove=!1;let t=!1;return this.boardLayout.forEach(e=>{for(let s=0;s<e.length-1;s++)0!==e[s]&&e[s]===e[s+1]&&(e[s]*=2,e[s+1]=0,this.canMove=!0,t=!0);for(let s=0;s<e.length;s++)if(0===e[s]){for(let o=s+1;o<e.length;o++)if(0!==e[o]){e[s]=e[o],e[o]=0,this.canMove=!0,t=!0;break}}}),this.lastMoveDirection&&this.lastMoveDirection===this.oppositeMoveDirections.left&&(this.canMove=!0),this.lastMoveDirection="left",this.updateBoardDisplay(),t}moveRight(){this.canMove=!1;let t=!1;return this.boardLayout.forEach(e=>{for(let s=e.length-2;s>=0;s--)0!==e[s]&&e[s]===e[s+1]&&(e[s+1]*=2,e[s]=0,this.canMove=!0,t=!0);for(let s=e.length-1;s>=0;s--)if(0===e[s]){for(let o=s-1;o>=0;o--)if(0!==e[o]){e[s]=e[o],e[o]=0,this.canMove=!0,t=!0;break}}}),this.lastMoveDirection&&this.lastMoveDirection===this.oppositeMoveDirections.right&&(this.canMove=!0),this.lastMoveDirection="left",this.updateBoardDisplay(),t}moveUp(){let t=!1,e=JSON.parse(JSON.stringify(this.boardLayout));return this.boardLayout[0].map((t,e)=>this.boardLayout.map(t=>t[e])).forEach((s,o)=>{let a=s.filter(t=>0!==t),i=[];for(let e=0;e<a.length;e++)a[e]===a[e+1]?(i.push(2*a[e]),t=!0,e++):i.push(a[e]);for(;i.length<s.length;)i.push(0);i.forEach((t,e)=>{this.boardLayout[e][o]=t}),this.areBoardsEqual(e,this.boardLayout)||(t=!0)}),t}moveDown(){let t=!1,e=JSON.parse(JSON.stringify(this.boardLayout));return this.boardLayout[0].map((t,e)=>this.boardLayout.map(t=>t[e])).forEach((s,o)=>{let a=s.filter(t=>0!==t).reverse(),i=[];for(let e=0;e<a.length;e++)a[e]===a[e+1]?(i.push(2*a[e]),t=!0,e++):i.push(a[e]);for(;i.length<s.length;)i.push(0);i.reverse(),i.forEach((t,e)=>{this.boardLayout[e][o]=t}),this.areBoardsEqual(e,this.boardLayout)||(t=!0)}),t}getScore(){let t=document.querySelector(".game-score"),e=[];return this.boardLayout.forEach(t=>{let s=t.reduce((t,e)=>t+e,0);e.push(s)}),t.textContent=e.reduce((t,e)=>t+e,0),t.textContent}getState(){return this.state}getStatus(){return this.status}start(){let t=()=>{"idle"===this.getState()?(this.startGame(),this.state="playing",this.controlButton.className="button restart",this.controlButton.textContent="Restart",this.startMessage.classList.add("hidden")):("playing"===this.getState()||"win"===this.getState()||"lose"===this.getState())&&this.restart()};this.controlButton.removeEventListener("click",this.controlHandler),this.controlButton.addEventListener("click",t),this.controlHandler=t}restart(){this.state="idle",this.status="process",this.startMessage.classList.remove("hidden"),this.winMessage.classList.add("hidden"),this.loseMessage.classList.add("hidden"),this.totalScoreMessage.classList.add("hidden"),this.controlButton.className="button start",this.controlButton.textContent="Start",this.boardLayout=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.updateBoardDisplay()}startGame(){this.state="playing",this.controlButton.className="button restart",this.controlButton.textContent="Restart",this.getScore(),this.initPLayerInput(),this.initCheats(),this.generateNewCells(),this.generateNewCells()}initPLayerInput(){this.resetInput(),"playing"===this.state&&this.bindPlayerInput()}initCheats(){this.resetCheats(),"playing"===this.state&&this.bindCheats()}bindPlayerInput(){document.addEventListener("keydown",this.handleInput)}bindCheats(){this.cheatButton.addEventListener("click",this.cheats)}resetInput(){document.removeEventListener("keydown",this.handleInput)}resetCheats(){this.cheatButton.removeEventListener("click",this.cheats)}handleInput=t=>{if("playing"!==this.state)return;let e=t.key.toLowerCase();(()=>{switch(e){case"a":return this.moveLeft();case"d":return this.moveRight();case"w":return this.moveUp();case"s":return this.moveDown();default:return!1}})()&&(this.generateNewCells(),this.getScore(),this.handleGameResolvment(),this.countMoves+=1,this.lastMoveDirection=e)};cheats=()=>{if("playing"!==this.state||document.querySelector(".cheat-menu-container"))return;let t=document.createElement("form");t.className="cheat-menu-container";let e=document.createElement("p");e.innerHTML='I used this to test <span style="color: green;">Win</span>/<span style="color: red;">Lose</span> system.<br>You used this because you are a <span style="color: red;">cheater</span>.<br>Its an open source game so you can add infinite money or whatever...<br>Add animations if you want, im not doing this...';let s=document.createElement("label");s.textContent="Win option: ";let o=document.createElement("select");o.className="cheat-menu__input";let a=document.createElement("option");a.text="Auto Win";let i=document.createElement("option");i.text="Auto Lose",o.add(a),o.add(i),s.appendChild(o);let r=document.createElement("button");r.className="apply-cheat-button",r.type="button",r.textContent="Apply",t.appendChild(s),t.appendChild(r),t.appendChild(e),document.body.appendChild(t),r.addEventListener("click",()=>{"Auto Win"===o.value?(this.boardLayout.forEach((t,e)=>{t.forEach((t,s)=>{this.boardLayout[e][s]=2048})}),this.updateBoardDisplay()):"Auto Lose"===o.value&&(this.boardLayout.forEach((t,e)=>{t.forEach((t,s)=>{this.boardLayout[e][s]=0})}),this.updateBoardDisplay(),this.showLoseMessage()),t.remove()})};generateNewCells(){let t=.9>Math.random()?2:4;if(this.emptyCells=[],this.boardLayout.forEach((t,e)=>{t.forEach((t,s)=>{0===t&&this.emptyCells.push({rowIndex:e,colIndex:s})})}),this.emptyCells.length>0){let e=Math.floor(Math.random()*this.emptyCells.length),{rowIndex:s,colIndex:o}=this.emptyCells[e];this.boardLayout[s][o]=t,this.updateBoardDisplay()}}updateBoardDisplay(){this.fieldRows.forEach((t,e)=>{Array.from(t.children).forEach((t,s)=>{let o=this.boardLayout[e][s];t.textContent=0!==o?o:"",t.className=`field-cell field-cell--${o}`,2048===o&&(this.status="win",this.state="win",this.totalScoreMessage.innerHTML=`Your total score is: ${this.getScore()}<br>Moves made `+this.countMoves,this.totalScoreMessage.classList.remove("hidden"),this.showWinMessage())})})}areBoardsEqual(t,e){return JSON.stringify(t)===JSON.stringify(e)}showLoseMessage(){this.loseMessage.classList.remove("hidden")}showWinMessage(){this.winMessage.classList.remove("hidden")}handleGameResolvment(){new Promise(t=>{this.boardLayout.some((t,e)=>t.some((s,o)=>o<t.length-1&&t[o]===t[o+1]||e<this.boardLayout.length-1&&this.boardLayout[e][o]===this.boardLayout[e+1][o]))||t("lose")}).then(()=>{this.status="lose",this.state="lose",this.totalScoreMessage.innerHTML=`Your total score is: ${this.getScore()}<br>Moves made `+this.countMoves,this.totalScoreMessage.classList.remove("hidden"),this.showLoseMessage()})}}().start();
//# sourceMappingURL=index.48a53eff.js.map
